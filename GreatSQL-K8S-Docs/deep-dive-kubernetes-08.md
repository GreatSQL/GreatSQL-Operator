
# 第八章 有状态与无状态应用

## 一、有状态与无状态应用的基本概念

有状态服务和无状态服务是两种不同的服务架构，它们在处理服务状态方面存在差异。服务状态是服务请求所需的数据，可以是一个变量或数据结构。无状态服务不会记录服务状态，每个请求之间是相互独立的，没有任何关联。

而有状态服务则相反，它会记录和维护服务状态，不同请求之间存在关联和依赖。这意味着有状态服务能够跟踪和处理请求之间的状态信息，以提供更复杂的功能和逻辑。无状态服务通常更易于扩展和部署，而有状态服务则更适合处理需要持久性状态的场景。

## 二、无状态应用

- 无状态服务是指应用程序不依赖于本地状态，并且可以以相同的方式处理每个请求。这意味着无状态服务的任何一个实例都可以处理来自客户端的请求，而这些请求之间是相互独立的，没有关联性。

- 无状态服务的典型示例包括Web服务器、API服务和负载均衡器等。这些服务可以通过水平扩展的方式来应对更多的请求流量，即通过增加副本数量来处理更多的请求。

- 无状态服务通常适合使用Kubernetes中的Deployment进行部署。这是因为无状态服务的实例可以随意启动和停止，而不会影响应用程序的状态或数据。Kubernetes的Deployment提供了方便的管理和自动化功能，可以轻松地扩展和管理无状态服务的副本。

## 三、有状态应用

- 有状态服务是指应用程序依赖于本地状态，通常需要稳定的标识和数据。这意味着每个实例都有唯一的标识，例如数据库服务器或消息队列，它们需要在启动、停止或故障转移时保留其数据和状态。与无状态服务不同，有状态服务需要特殊的处理和管理，以确保数据的一致性和持久性。

- 有状态服务的典型示例包括数据库系统（如GreatSQ，MySQL）和消息队列（如RabbitMQ、Kafka）等。这些服务通常需要持久性存储来保存数据。

- Kubernetes的StatefulSet是一种用于部署有状态服务的解决方案。StatefulSet能够有效地管理有状态的应用程序，并为每个Pod提供独一无二的标识和稳定的网络标识，从而确保有状态服务的稳定性。

## 四、有状态与无状态应用区别

部署模式不同:

- Deployment 管理无状态应用，实例是无差别的。
- StatefulSet 管理有状态应用，实例之间有顺序和依赖。

存储方式不同:

- Deployment 的每个实例存储是独立的。
- StatefulSet中的每个实例存储可以通过PVC依次关联。

网络标识不同:

- Deployment 中每个 Pod 的网络标识是随机动态分配的。
- StatefulSet 中每个 Pod 的网络标识是固定唯一的，按顺序分配。

扩缩容方式不同:

- Deployment 支持水平扩缩容/减少实例个数。
- StatefulSet 支持滚动更新，容忍度更高。

生命周期不同:

- Deployment 中 Pod 是相对独立的。
- StatefulSet 中 Pod 是有依赖关系的。

## 参考资料

- [Docker与Kubernetes容器运维实战](https://baike.baidu.com/item/Docker与Kubernetes容器运维实战/63475077?fr=ge_ala)

## 免责声明

因个人水平有限，专栏中难免存在错漏之处，请勿直接复制文档中的命令、方法直接应用于线上生产环境。请读者们务必先充分理解并在测试环境验证通过后方可正式实施，避免造成生产环境的破坏或损害。

## 联系我们
---
扫码关注微信公众号

![输入图片说明](../greatsql-wx.jpg)
